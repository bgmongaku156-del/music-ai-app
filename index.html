<script>

let generating = false;

async function generateMusic(duration){

 if(generating) return;

 generating = true;

 const btn1 = document.getElementById("btn1");
 const btn3 = document.getElementById("btn3");

 btn1.disabled = true;
 btn3.disabled = true;

 document.getElementById("status").innerText="生成中...";

 try{

 const res = await fetch("/api/music",{
 method:"POST",
 headers:{
 "Content-Type":"application/json"
 },
 body:JSON.stringify({
 prompt:document.getElementById("prompt").value,
 duration:duration
 })
 });

 const data = await res.json();

 if(!data.url){
 throw new Error("fail");
 }

 document.getElementById("audio").src=data.url;

 document.getElementById("status").innerText="生成完了";

 }catch(e){

 document.getElementById("status").innerText="生成失敗";

 }

 btn1.disabled=false;
 btn3.disabled=false;

 generating=false;

}

</script>

<!DOCTYPE html>
<html lang="ja">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>AI音楽生成（商用利用OK）</title>

<meta name="description"
content="AIが音楽を自動生成します。商用利用可能。">

<script async
src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9468732939524959"
crossorigin="anonymous"></script>

<style>

body{
background:#111;
color:white;
font-family:sans-serif;
text-align:center;
padding:20px;
}

textarea{
width:90%;
height:120px;
font-size:16px;
}

button{
width:90%;
padding:18px;
font-size:20px;
margin-top:10px;
border-radius:10px;
border:none;
background:green;
color:white;
}

button:disabled{
background:gray;
}

audio{
width:90%;
margin-top:20px;
}

.hidden{
display:none;
}

</style>

</head>

<body>

<h1>AI音楽生成（商用利用OK）</h1>

<p>
AIが自動で音楽を生成できます。<br>
生成された音楽は商用利用可能です。
</p>


<!-- 広告 -->

<ins class="adsbygoogle"
style="display:block;min-height:90px"
data-ad-client="ca-pub-9468732939524959"
data-ad-slot="1234567890"
data-ad-format="auto">
</ins>

<script>
(adsbygoogle=window.adsbygoogle||[]).push({});
</script>


<p id="status">
広告を読み込んでいます...
</p>


<div id="mainUI" class="hidden">

<textarea id="prompt">
relaxing ambient music
</textarea>


<button id="adBtn" onclick="watchAd()">
広告を見る
</button>


<button id="btn1" disabled onclick="gen1()">
1分生成（広告3回）
</button>


<button id="btn3" disabled onclick="gen3()">
3分生成（広告4回）
</button>


<audio id="player" controls></audio>


<button id="downloadBtn" disabled onclick="watchDownloadAd()">
ダウンロード（広告1回）
</button>


<br><br>

<a href="プライバシー.html">プライバシーポリシー</a>
<br>
<a href="利用規約.html">利用規約</a>
<br>
<a href="について.html">About</a>

</div>


<script>

let adsWatched=0
let blobURL=null
let generating=false
let downloadReady=false



// 広告読み込み確認

function waitAds(){

let ad=document.querySelector(".adsbygoogle")

if(!ad)return


if(ad.offsetHeight>50){

status.innerText="広告を確認しました"

mainUI.classList.remove("hidden")

clearInterval(adTimer)

}

}


// 起動時チェック

let adTimer=setInterval(waitAds,1000)





// 広告確認

async function checkAds(){

let ad=document.querySelector(".adsbygoogle")

if(!ad || ad.offsetHeight<50){

status.innerText="広告ブロッカーをOFFにしてください"

return false

}


await new Promise(r=>setTimeout(r,1000))


if(ad.offsetHeight<50){

status.innerText="広告が表示されていません"

return false

}


return true

}




async function watchAd(){

let ok=await checkAds()

if(!ok)return


adsWatched++


status.innerText=
"広告 "+adsWatched+"回 視聴済み"



if(adsWatched>=3){
btn1.disabled=false
}

if(adsWatched>=4){
btn3.disabled=false
}

}




async function generate(seconds){

let ok=await checkAds()

if(!ok)return

if(generating)return


generating=true


btn1.disabled=true
btn3.disabled=true
adBtn.disabled=true


status.innerText="生成中..."


let res=await fetch("/api/music",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({

prompt:prompt.value,
duration:seconds

})

})


let blob=await res.blob()

blobURL=URL.createObjectURL(blob)

player.src=blobURL


status.innerText="生成完了"


adsWatched=0

downloadReady=true
downloadBtn.disabled=false

adBtn.disabled=false


generating=false

}



function gen1(){
generate(60)
}


function gen3(){
generate(180)
}




async function watchDownloadAd(){

if(!downloadReady)return

let ok=await checkAds()

if(!ok)return


status.innerText="ダウンロード広告表示中..."


setTimeout(()=>{

downloadMusic()

},5000)

}



function downloadMusic(){

let a=document.createElement("a")

a.href=blobURL

a.download="music.mp3"

a.click()

status.innerText="ダウンロード完了"

downloadReady=false
downloadBtn.disabled=true

}


</script>

</body>
</html>

<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width">

<style>

body{
background:#111;
color:white;
text-align:center;
font-family:sans-serif;
padding:30px;
}

button{
font-size:20px;
padding:15px;
margin:10px;
}

audio{
width:90%;
margin-top:20px;
}

</style>

</head>

<body>

<h2>AI音楽MP3生成</h2>

<button onclick="generate(10)">
10分MP3生成
</button>

<br>

<button onclick="generate(30)">
30分MP3生成
</button>

<br>

<audio id="player"
controls></audio>

<br><br>

<a id="download"
style="color:#0f0;font-size:20px">
</a>


<script>

async function generate(minutes){

const segments =
Math.floor((minutes*60)/6);

let buffers=[];


// AI生成ループ
for(let i=0;i<segments;i++){

const res=
await fetch("/api/music");

const data=
await res.json();

const mp3=
await fetch(data.url);

const array=
await mp3.arrayBuffer();

buffers.push(array);

}


// MP3結合
let totalLength=0;

buffers.forEach(b=>{
totalLength+=b.byteLength;
});

const merged=
new Uint8Array(totalLength);

let offset=0;

buffers.forEach(b=>{

merged.set(new Uint8Array(b),offset);

offset+=b.byteLength;

});


// Blob化
const blob=
new Blob([merged],{
type:"audio/mp3"
});


const url=
URL.createObjectURL(blob);


// 再生
document.getElementById("player")
.src=url;


// ダウンロード
const d=
document.getElementById("download");

d.href=url;

d.download="ai-music.mp3";

d.innerText=
"MP3ダウンロード";

}

</script>

</body>

</html>

<!DOCTYPE html>
<html>

<body style="background:black;color:white;padding:20px;">

<h2>AI音楽生成</h2>

<textarea id="prompt"
style="width:100%;height:120px;">
relaxing ambient music
</textarea>


<button onclick="make1min()"
style="width:100%;padding:20px;font-size:20px;">
1分生成（30秒×2）
</button>


<button onclick="make3min()"
style="width:100%;padding:20px;font-size:20px;">
3分生成（90秒×2）
</button>


<div id="status"
style="margin-top:20px;font-size:20px;">
待機中
</div>


<audio id="player"
controls
style="width:100%;margin-top:20px;">
</audio>


<script>

async function generate(prompt,seconds){

const r=await fetch("/api/music",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({
prompt:prompt,
seconds:seconds
})

})

return await r.json()

}



// 共通生成関数

async function generateParts(prompt,seconds,parts){

let list=[]

let totalTime=seconds*parts

let remain=totalTime

for(let i=0;i<parts;i++){

document.getElementById("status").innerText=

"生成中 残り約 "+remain+" 秒"

let start=Date.now()

let d=await generate(prompt,seconds)

list.push(d.url)

let end=Date.now()

let used=Math.floor((end-start)/1000)

remain-=used

if(remain<0)remain=0

}

document.getElementById("status").innerText=

"生成完了"

playList(list)

}



// 1分生成

function make1min(){

const prompt=
document.getElementById("prompt").value

generateParts(prompt,30,2)

}



// 3分生成

function make3min(){

const prompt=
document.getElementById("prompt").value

generateParts(prompt,90,2)

}



// 再生

function playList(list){

let i=0

player.src=list[0]

player.onended=function(){

i++

if(i<list.length){

player.src=list[i]

player.play()

}

}

player.play()

}

</script>

</body>

</html>
